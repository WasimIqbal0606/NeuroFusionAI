<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NeuroFusionOS - Interactive Emotion Mapping Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/examples/js/postprocessing/EffectComposer.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/examples/js/postprocessing/RenderPass.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
  <style>
    :root {
      --primary-color: #00f0ff;
      --secondary-color: #7700ff;
      --accent-color: #ff00aa;
      --background-dark: #050510;
      --background-medium: #080830;
      --background-light: #10105a;
      --text-primary: #ffffff;
      --text-secondary: #aaaaff;
      --success-color: #00ffa3;
      --warning-color: #ffcc00;
      --error-color: #ff2266;
      --joy-color: #ffcc00;
      --sadness-color: #0077ff;
      --anger-color: #ff3333;
      --fear-color: #7700ff;
      --surprise-color: #00ffa3;
      --disgust-color: #88cc00;
      --trust-color: #00ccff;
      --anticipation-color: #ff9900;
      --love-color: #ff66aa;
      --glow-primary: 0 0 10px rgba(0, 240, 255, 0.7);
      --glow-secondary: 0 0 15px rgba(119, 0, 255, 0.7);
      --glow-accent: 0 0 15px rgba(255, 0, 170, 0.7);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--background-dark);
      color: var(--text-primary);
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      position: relative;
    }
    
    .container {
      display: grid;
      grid-template-rows: auto 1fr auto;
      grid-template-columns: 300px 1fr 300px;
      grid-template-areas:
        "header header header"
        "left-panel main right-panel"
        "footer footer footer";
      height: 100vh;
      padding: 20px;
      gap: 20px;
    }
    
    .panel {
      background: rgba(8, 8, 48, 0.7);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      padding: 20px;
    }
    
    .header {
      grid-area: header;
      border: 1px solid rgba(0, 240, 255, 0.2);
      box-shadow: var(--glow-primary), inset 0 0 20px rgba(0, 240, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 1.4rem;
      background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .logo-icon {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      box-shadow: var(--glow-primary);
    }
    
    .nav-controls {
      display: flex;
      gap: 15px;
    }
    
    .nav-item {
      padding: 8px 15px;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.8rem;
      letter-spacing: 1px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(0, 240, 255, 0.2);
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .nav-item:hover, .nav-item.active {
      background: rgba(0, 240, 255, 0.1);
      box-shadow: var(--glow-primary);
      transform: translateY(-2px);
    }
    
    .left-panel {
      grid-area: left-panel;
      border: 1px solid rgba(0, 240, 255, 0.2);
      box-shadow: var(--glow-primary), inset 0 0 20px rgba(0, 240, 255, 0.1);
      display: flex;
      flex-direction: column;
      gap: 20px;
      overflow-y: auto;
    }
    
    .control-section {
      margin-bottom: 15px;
    }
    
    .section-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 10px;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .control-group {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 15px;
      border: 1px solid rgba(0, 240, 255, 0.1);
    }
    
    .control-row {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .control-row:last-child {
      margin-bottom: 0;
    }
    
    .control-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      width: 100px;
      flex-shrink: 0;
    }
    
    .control-input {
      flex: 1;
    }
    
    .slider-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .slider {
      flex: 1;
      -webkit-appearance: none;
      appearance: none;
      height: 6px;
      border-radius: 3px;
      background: rgba(255, 255, 255, 0.1);
      outline: none;
    }
    
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--primary-color);
      cursor: pointer;
      box-shadow: var(--glow-primary);
    }
    
    .slider-value {
      font-size: 0.8rem;
      font-family: 'Orbitron', sans-serif;
      width: 40px;
      text-align: center;
    }
    
    .button-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .control-button {
      flex: 1;
      padding: 8px 0;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(0, 240, 255, 0.2);
      border-radius: 10px;
      color: var(--text-primary);
      font-family: 'Orbitron', sans-serif;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .control-button:hover, .control-button.active {
      background: rgba(0, 240, 255, 0.1);
      box-shadow: var(--glow-primary);
      transform: translateY(-2px);
    }
    
    .control-button.accent {
      border-color: rgba(255, 0, 170, 0.3);
    }
    
    .control-button.accent:hover {
      background: rgba(255, 0, 170, 0.1);
      box-shadow: var(--glow-accent);
    }
    
    .toggle-button {
      width: 50px;
      height: 24px;
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .toggle-button::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--text-secondary);
      transition: all 0.3s ease;
    }
    
    .toggle-button.active {
      background: rgba(0, 240, 255, 0.2);
      border-color: rgba(0, 240, 255, 0.4);
    }
    
    .toggle-button.active::after {
      left: calc(100% - 20px);
      background: var(--primary-color);
      box-shadow: var(--glow-primary);
    }
    
    .right-panel {
      grid-area: right-panel;
      border: 1px solid rgba(119, 0, 255, 0.2);
      box-shadow: var(--glow-secondary), inset 0 0 20px rgba(119, 0, 255, 0.1);
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .main-content {
      grid-area: main;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    
    .visualization-container {
      flex: 1;
      border-radius: 20px;
      overflow: hidden;
      position: relative;
      min-height: 200px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(0, 240, 255, 0.1);
      display: flex;
      flex-direction: column;
    }
    
    .footer {
      grid-area: footer;
      border: 1px solid rgba(255, 0, 170, 0.2);
      box-shadow: var(--glow-accent), inset 0 0 20px rgba(255, 0, 170, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .footer-logo {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.9rem;
      color: var(--accent-color);
    }
    
    .footer-info {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }
    
    /* Emotion-specific styles */
    .emotion-sliders {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .emotion-slider {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .emotion-label {
      width: 90px;
      font-size: 0.85rem;
      color: var(--text-secondary);
      text-align: right;
    }
    
    .emotion-value {
      width: 40px;
      font-size: 0.8rem;
      font-family: 'Orbitron', sans-serif;
      text-align: center;
    }
    
    /* Visualization-specific styles */
    .visualization-view {
      position: relative;
      flex: 1;
      overflow: hidden;
    }
    
    .visualization-tabs {
      display: flex;
      gap: 5px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.2);
    }
    
    .tab {
      padding: 8px 15px;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.8rem;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.3);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .tab:hover {
      background: rgba(0, 240, 255, 0.1);
    }
    
    .tab.active {
      background: rgba(0, 240, 255, 0.2);
      box-shadow: var(--glow-primary);
    }
    
    /* Emotion wheel specific styles */
    .emotion-wheel-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    /* 3D emotion space specific styles */
    .emotion-space-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    /* Timeline specific styles */
    .emotion-timeline-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 20px;
    }
    
    /* Network specific styles */
    .emotion-network-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    /* Stats section */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 10px;
    }
    
    .stat-item {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 12px;
      border: 1px solid rgba(119, 0, 255, 0.2);
      transition: all 0.3s ease;
    }
    
    .stat-item:hover {
      transform: translateY(-3px);
      box-shadow: var(--glow-secondary);
    }
    
    .stat-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 0.7rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    /* Journal entries */
    .journal-list {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 10px;
    }
    
    .journal-entry {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 10px;
      border: 1px solid rgba(119, 0, 255, 0.2);
      transition: all 0.3s ease;
    }
    
    .journal-entry:hover {
      transform: translateY(-2px);
      box-shadow: var(--glow-secondary);
    }
    
    .entry-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }
    
    .entry-title {
      font-weight: 500;
      color: var(--text-primary);
    }
    
    .entry-date {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }
    
    .entry-text {
      font-size: 0.9rem;
      line-height: 1.4;
      margin-bottom: 8px;
    }
    
    .entry-emotion-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    
    .emotion-tag {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 10px;
      background: rgba(0, 240, 255, 0.1);
    }
    
    .emotion-tag.joy {
      background: rgba(255, 204, 0, 0.2);
      border: 1px solid rgba(255, 204, 0, 0.3);
    }
    
    .emotion-tag.sadness {
      background: rgba(0, 119, 255, 0.2);
      border: 1px solid rgba(0, 119, 255, 0.3);
    }
    
    .emotion-tag.anger {
      background: rgba(255, 51, 51, 0.2);
      border: 1px solid rgba(255, 51, 51, 0.3);
    }
    
    .emotion-tag.fear {
      background: rgba(119, 0, 255, 0.2);
      border: 1px solid rgba(119, 0, 255, 0.3);
    }
    
    .emotion-tag.surprise {
      background: rgba(0, 255, 163, 0.2);
      border: 1px solid rgba(0, 255, 163, 0.3);
    }
    
    .emotion-tag.disgust {
      background: rgba(136, 204, 0, 0.2);
      border: 1px solid rgba(136, 204, 0, 0.3);
    }
    
    .emotion-tag.trust {
      background: rgba(0, 204, 255, 0.2);
      border: 1px solid rgba(0, 204, 255, 0.3);
    }
    
    .emotion-tag.anticipation {
      background: rgba(255, 153, 0, 0.2);
      border: 1px solid rgba(255, 153, 0, 0.3);
    }
    
    .emotion-tag.love {
      background: rgba(255, 102, 170, 0.2);
      border: 1px solid rgba(255, 102, 170, 0.3);
    }
    
    /* Input form */
    .input-form {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
    }
    
    .form-row {
      margin-bottom: 10px;
    }
    
    .form-label {
      display: block;
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 5px;
    }
    
    .text-input {
      width: 100%;
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(0, 240, 255, 0.2);
      border-radius: 5px;
      color: var(--text-primary);
      font-family: 'Inter', sans-serif;
    }
    
    .text-area {
      width: 100%;
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(0, 240, 255, 0.2);
      border-radius: 5px;
      color: var(--text-primary);
      font-family: 'Inter', sans-serif;
      resize: vertical;
      min-height: 80px;
    }
    
    /* Insight section */
    .insight-card {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      border: 1px solid rgba(0, 255, 163, 0.3);
    }
    
    .insight-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.9rem;
      color: var(--success-color);
      margin-bottom: 10px;
    }
    
    .insight-text {
      font-size: 0.9rem;
      line-height: 1.5;
    }
    
    /* Chart tooltip */
    .tooltip {
      position: absolute;
      padding: 10px;
      background: rgba(8, 8, 48, 0.9);
      border-radius: 8px;
      pointer-events: none;
      font-size: 0.9rem;
      border: 1px solid var(--primary-color);
      box-shadow: var(--glow-primary);
      z-index: 100;
    }
    
    /* Media Queries */
    @media (max-width: 1200px) {
      .container {
        grid-template-columns: 250px 1fr 250px;
      }
    }
    
    @media (max-width: 992px) {
      .container {
        grid-template-columns: 200px 1fr;
        grid-template-areas:
          "header header"
          "left-panel main"
          "footer footer";
      }
      
      .right-panel {
        display: none;
      }
    }
    
    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
        grid-template-areas:
          "header"
          "main"
          "left-panel"
          "footer";
      }
      
      .header {
        padding: 10px 15px;
      }
      
      .logo {
        font-size: 1.2rem;
      }
      
      .nav-controls {
        display: none;
      }
      
      .left-panel {
        margin-top: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="panel header">
      <div class="logo">
        <div class="logo-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z" fill="white"/>
            <path d="M12 6C8.69 6 6 8.69 6 12C6 15.31 8.69 18 12 18C15.31 18 18 15.31 18 12C18 8.69 15.31 6 12 6ZM12 16C9.79 16 8 14.21 8 12C8 9.79 9.79 8 12 8C14.21 8 16 9.79 16 12C16 14.21 14.21 16 12 16Z" fill="white"/>
          </svg>
        </div>
        <div>Emotion Mapping Dashboard</div>
      </div>
      
      <div class="nav-controls">
        <div class="nav-item active">EMOTIONS</div>
        <div class="nav-item">INSIGHTS</div>
        <div class="nav-item">JOURNAL</div>
        <div class="nav-item">PROFILE</div>
      </div>
    </header>
    
    <section class="panel left-panel">
      <div class="control-section">
        <div class="section-title">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 14C8 14 9.5 16 12 16C14.5 16 16 14 16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 9H9.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15 9H15.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          CURRENT EMOTIONS
        </div>
        <div class="control-group">
          <div class="emotion-sliders">
            <div class="emotion-slider">
              <div class="emotion-label">Joy</div>
              <input type="range" min="0" max="100" value="60" class="slider" id="joy-slider" data-color="var(--joy-color)">
              <div class="emotion-value" id="joy-value">60</div>
            </div>
            <div class="emotion-slider">
              <div class="emotion-label">Sadness</div>
              <input type="range" min="0" max="100" value="25" class="slider" id="sadness-slider" data-color="var(--sadness-color)">
              <div class="emotion-value" id="sadness-value">25</div>
            </div>
            <div class="emotion-slider">
              <div class="emotion-label">Anger</div>
              <input type="range" min="0" max="100" value="10" class="slider" id="anger-slider" data-color="var(--anger-color)">
              <div class="emotion-value" id="anger-value">10</div>
            </div>
            <div class="emotion-slider">
              <div class="emotion-label">Fear</div>
              <input type="range" min="0" max="100" value="20" class="slider" id="fear-slider" data-color="var(--fear-color)">
              <div class="emotion-value" id="fear-value">20</div>
            </div>
            <div class="emotion-slider">
              <div class="emotion-label">Surprise</div>
              <input type="range" min="0" max="100" value="45" class="slider" id="surprise-slider" data-color="var(--surprise-color)">
              <div class="emotion-value" id="surprise-value">45</div>
            </div>
            <div class="emotion-slider">
              <div class="emotion-label">Disgust</div>
              <input type="range" min="0" max="100" value="5" class="slider" id="disgust-slider" data-color="var(--disgust-color)">
              <div class="emotion-value" id="disgust-value">5</div>
            </div>
            <div class="emotion-slider">
              <div class="emotion-label">Trust</div>
              <input type="range" min="0" max="100" value="70" class="slider" id="trust-slider" data-color="var(--trust-color)">
              <div class="emotion-value" id="trust-value">70</div>
            </div>
            <div class="emotion-slider">
              <div class="emotion-label">Anticipation</div>
              <input type="range" min="0" max="100" value="55" class="slider" id="anticipation-slider" data-color="var(--anticipation-color)">
              <div class="emotion-value" id="anticipation-value">55</div>
            </div>
            <div class="emotion-slider">
              <div class="emotion-label">Love</div>
              <input type="range" min="0" max="100" value="65" class="slider" id="love-slider" data-color="var(--love-color)">
              <div class="emotion-value" id="love-value">65</div>
            </div>
          </div>
          
          <div class="button-row">
            <div class="control-button" id="reset-button">RESET</div>
            <div class="control-button accent" id="save-button">SAVE</div>
          </div>
        </div>
      </div>
      
      <div class="control-section">
        <div class="section-title">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 3V21M16.6 3H7.4C6.08 3 5 4.08 5 5.4V18.6C5 19.92 6.08 21 7.4 21H16.6C17.92 21 19 19.92 19 18.6V5.4C19 4.08 17.92 3 16.6 3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          NEW JOURNAL ENTRY
        </div>
        <div class="control-group">
          <div class="input-form">
            <div class="form-row">
              <label class="form-label" for="entry-title">Title</label>
              <input type="text" id="entry-title" class="text-input" placeholder="How are you feeling today?">
            </div>
            <div class="form-row">
              <label class="form-label" for="entry-text">Journal Entry</label>
              <textarea id="entry-text" class="text-area" placeholder="Describe your emotions and experiences..."></textarea>
            </div>
            <div class="button-row">
              <div class="control-button accent" id="analyze-button">ANALYZE & SAVE</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="control-section">
        <div class="section-title">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 17H7V10H9V17ZM13 17H11V7H13V17ZM17 17H15V13H17V17ZM19 19H5V5H19V19.1M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3Z" fill="currentColor"/>
          </svg>
          VISUALIZATION OPTIONS
        </div>
        <div class="control-group">
          <div class="control-row">
            <div class="control-label">Time Range</div>
            <div class="control-input">
              <select id="time-range" class="text-input">
                <option value="day">Today</option>
                <option value="week" selected>Past Week</option>
                <option value="month">Past Month</option>
                <option value="year">Past Year</option>
                <option value="all">All Time</option>
              </select>
            </div>
          </div>
          <div class="control-row">
            <div class="control-label">Show Labels</div>
            <div class="control-input">
              <div class="toggle-button active" id="labels-toggle"></div>
            </div>
          </div>
          <div class="control-row">
            <div class="control-label">Animation</div>
            <div class="control-input">
              <div class="toggle-button active" id="animation-toggle"></div>
            </div>
          </div>
          <div class="control-row">
            <div class="control-label">Resolution</div>
            <div class="control-input slider-container">
              <input type="range" class="slider" id="resolution" min="1" max="5" value="3">
              <div class="slider-value" id="resolution-value">3</div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <section class="main-content">
      <div class="visualization-container">
        <div class="visualization-tabs">
          <div class="tab active" data-tab="wheel">EMOTION WHEEL</div>
          <div class="tab" data-tab="space">3D SPACE</div>
          <div class="tab" data-tab="timeline">TIMELINE</div>
          <div class="tab" data-tab="network">NETWORK</div>
        </div>
        
        <div class="visualization-view">
          <!-- Emotion Wheel Visualization -->
          <div class="emotion-wheel-container" id="emotion-wheel-container"></div>
          
          <!-- 3D Emotion Space Visualization -->
          <div class="emotion-space-container" id="emotion-space-container" style="display: none;"></div>
          
          <!-- Emotion Timeline Visualization -->
          <div class="emotion-timeline-container" id="emotion-timeline-container" style="display: none;"></div>
          
          <!-- Emotion Network Visualization -->
          <div class="emotion-network-container" id="emotion-network-container" style="display: none;"></div>
        </div>
      </div>
      
      <div class="insight-card">
        <div class="insight-title">NEURAL INSIGHT</div>
        <div class="insight-text" id="insight-text">
          Your emotional patterns show a positive trend over the past week. Joy and trust are increasing, while fear and sadness are decreasing. This suggests an improvement in your emotional well-being. You might want to continue the activities that have contributed to this positive shift.
        </div>
      </div>
    </section>
    
    <section class="panel right-panel">
      <div class="section-title">EMOTIONAL METRICS</div>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value" id="balance-score">78%</div>
          <div class="stat-label">Emotional Balance</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="wellbeing-score">65%</div>
          <div class="stat-label">Well-being Index</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="variance-score">42%</div>
          <div class="stat-label">Emotional Variance</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="coherence-score">84%</div>
          <div class="stat-label">Emotional Coherence</div>
        </div>
      </div>
      
      <div class="section-title" style="margin-top: 20px;">RECENT JOURNAL ENTRIES</div>
      <div class="journal-list" id="journal-list">
        <!-- Journal entries will be loaded here -->
        <div class="journal-entry">
          <div class="entry-header">
            <div class="entry-title">Feeling optimistic today</div>
            <div class="entry-date">Today, 2:30 PM</div>
          </div>
          <div class="entry-text">
            Had a productive meeting with the team. The project is finally moving forward after weeks of delays.
          </div>
          <div class="entry-emotion-tags">
            <div class="emotion-tag joy">Joy</div>
            <div class="emotion-tag anticipation">Anticipation</div>
            <div class="emotion-tag trust">Trust</div>
          </div>
        </div>
        
        <div class="journal-entry">
          <div class="entry-header">
            <div class="entry-title">Unexpected news</div>
            <div class="entry-date">Yesterday, 7:15 PM</div>
          </div>
          <div class="entry-text">
            Received some unexpected news about the project deadline. Feeling a mix of stress and excitement about the challenge.
          </div>
          <div class="entry-emotion-tags">
            <div class="emotion-tag surprise">Surprise</div>
            <div class="emotion-tag fear">Fear</div>
            <div class="emotion-tag anticipation">Anticipation</div>
          </div>
        </div>
        
        <div class="journal-entry">
          <div class="entry-header">
            <div class="entry-title">Weekend reflection</div>
            <div class="entry-date">Sunday, 10:45 AM</div>
          </div>
          <div class="entry-text">
            Taking time to reflect on the past week. Grateful for the support of friends and family during challenging moments.
          </div>
          <div class="entry-emotion-tags">
            <div class="emotion-tag love">Love</div>
            <div class="emotion-tag trust">Trust</div>
            <div class="emotion-tag joy">Joy</div>
          </div>
        </div>
      </div>
    </section>
    
    <footer class="panel footer">
      <div class="footer-logo">NeuroFusionOS</div>
      <div class="footer-info">Emotional data is stored locally and never shared</div>
    </footer>
  </div>
  
  <script>
    // Global variables
    let emotions = {
      joy: 60,
      sadness: 25,
      anger: 10,
      fear: 20,
      surprise: 45,
      disgust: 5,
      trust: 70,
      anticipation: 55,
      love: 65
    };
    
    // Visualization-specific variables
    let emotionWheelSvg;
    let scene, camera, renderer, controls, composer;
    let emotionSpheres = [];
    let timelineSvg;
    let networkSvg;
    let journalEntries = [];
    let selectedTab = 'wheel';
    
    // Initialize everything
    document.addEventListener('DOMContentLoaded', () => {
      initSliders();
      initButtons();
      initTabs();
      initToggleButtons();
      loadSampleJournalEntries();
      initEmotionWheel();
      init3DEmotionSpace();
      initEmotionTimeline();
      initEmotionNetwork();
      updateInsight();
      updateMetrics();
    });
    
    // Initialize sliders
    function initSliders() {
      const sliders = document.querySelectorAll('.slider');
      
      sliders.forEach(slider => {
        const emotion = slider.id.split('-')[0];
        const valueElement = document.getElementById(`${emotion}-value`);
        
        // Set initial value
        emotions[emotion] = parseInt(slider.value);
        valueElement.textContent = slider.value;
        
        // Set slider color
        const color = slider.getAttribute('data-color');
        if (color) {
          slider.style.background = `linear-gradient(to right, ${color} 0%, ${color} ${slider.value}%, rgba(255, 255, 255, 0.1) ${slider.value}%, rgba(255, 255, 255, 0.1) 100%)`;
        }
        
        // Update on change
        slider.addEventListener('input', () => {
          emotions[emotion] = parseInt(slider.value);
          valueElement.textContent = slider.value;
          
          // Update slider color
          if (color) {
            slider.style.background = `linear-gradient(to right, ${color} 0%, ${color} ${slider.value}%, rgba(255, 255, 255, 0.1) ${slider.value}%, rgba(255, 255, 255, 0.1) 100%)`;
          }
          
          // Update visualizations
          updateVisualizations();
        });
      });
    }
    
    // Initialize buttons
    function initButtons() {
      // Reset button
      document.getElementById('reset-button').addEventListener('click', resetEmotions);
      
      // Save button
      document.getElementById('save-button').addEventListener('click', saveEmotions);
      
      // Analyze button
      document.getElementById('analyze-button').addEventListener('click', analyzeAndSaveJournal);
    }
    
    // Initialize tabs
    function initTabs() {
      const tabs = document.querySelectorAll('.tab');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // Remove active class from all tabs
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          
          // Add active class to clicked tab
          tab.classList.add('active');
          
          // Hide all visualization containers
          document.getElementById('emotion-wheel-container').style.display = 'none';
          document.getElementById('emotion-space-container').style.display = 'none';
          document.getElementById('emotion-timeline-container').style.display = 'none';
          document.getElementById('emotion-network-container').style.display = 'none';
          
          // Show selected container
          selectedTab = tab.getAttribute('data-tab');
          document.getElementById(`emotion-${selectedTab}-container`).style.display = 'block';
          
          // Update the visualization
          updateVisualizations();
        });
      });
    }
    
    // Initialize toggle buttons
    function initToggleButtons() {
      const toggleButtons = document.querySelectorAll('.toggle-button');
      
      toggleButtons.forEach(button => {
        button.addEventListener('click', () => {
          button.classList.toggle('active');
          updateVisualizations();
        });
      });
    }
    
    // Reset emotions to default values
    function resetEmotions() {
      const defaultValues = {
        joy: 50,
        sadness: 50,
        anger: 50,
        fear: 50,
        surprise: 50,
        disgust: 50,
        trust: 50,
        anticipation: 50,
        love: 50
      };
      
      // Update sliders and values
      Object.keys(defaultValues).forEach(emotion => {
        const slider = document.getElementById(`${emotion}-slider`);
        const valueElement = document.getElementById(`${emotion}-value`);
        
        slider.value = defaultValues[emotion];
        valueElement.textContent = defaultValues[emotion];
        emotions[emotion] = defaultValues[emotion];
        
        // Update slider color
        const color = slider.getAttribute('data-color');
        if (color) {
          slider.style.background = `linear-gradient(to right, ${color} 0%, ${color} ${slider.value}%, rgba(255, 255, 255, 0.1) ${slider.value}%, rgba(255, 255, 255, 0.1) 100%)`;
        }
      });
      
      // Update visualizations
      updateVisualizations();
    }
    
    // Save current emotions
    function saveEmotions() {
      // In a real app, this would save to a database or local storage
      // For this demo, we'll just add to the journal entries
      const timestamp = new Date();
      
      const entry = {
        title: "Emotion Update",
        date: timestamp,
        text: "Updated my emotional state through the dashboard.",
        emotions: { ...emotions }
      };
      
      // Add to journal entries
      journalEntries.unshift(entry);
      
      // Update journal list
      updateJournalList();
      
      // Update visualizations
      updateVisualizations();
      
      // Show confirmation
      alert('Emotions saved successfully!');
    }
    
    // Analyze and save journal entry
    function analyzeAndSaveJournal() {
      const title = document.getElementById('entry-title').value || "Untitled Entry";
      const text = document.getElementById('entry-text').value;
      
      if (!text) {
        alert('Please enter some text for your journal entry.');
        return;
      }
      
      // Analyze text to determine emotions (in a real app, this would use AI)
      const analyzedEmotions = analyzeText(text);
      
      // Create journal entry
      const entry = {
        title: title,
        date: new Date(),
        text: text,
        emotions: analyzedEmotions
      };
      
      // Add to journal entries
      journalEntries.unshift(entry);
      
      // Update journal list
      updateJournalList();
      
      // Update visualizations
      updateVisualizations();
      
      // Update insights based on new data
      updateInsight();
      
      // Clear form
      document.getElementById('entry-title').value = '';
      document.getElementById('entry-text').value = '';
      
      // Show confirmation
      alert('Journal entry saved and analyzed!');
    }
    
    // Simple text analysis function (placeholder for AI)
    function analyzeText(text) {
      // This is a very simple mock analysis
      // In a real app, this would use NLP or emotion AI
      const words = text.toLowerCase().split(/\s+/);
      
      const emotionWords = {
        joy: ['happy', 'joy', 'excited', 'glad', 'delight', 'pleased', 'smile', 'laugh', 'fun', 'wonderful'],
        sadness: ['sad', 'unhappy', 'depressed', 'down', 'blue', 'sorrow', 'grief', 'cry', 'tears', 'upset'],
        anger: ['angry', 'mad', 'furious', 'rage', 'hate', 'hostile', 'irritated', 'annoyed', 'frustrated', 'bitter'],
        fear: ['afraid', 'fear', 'scared', 'anxious', 'worry', 'panic', 'terror', 'dread', 'nervous', 'frightened'],
        surprise: ['surprised', 'amazed', 'astonished', 'shocked', 'wonder', 'awe', 'startled', 'unexpected', 'sudden', 'wow'],
        disgust: ['disgusted', 'gross', 'revolting', 'nasty', 'repulsed', 'sick', 'yuck', 'ew', 'distaste', 'aversion'],
        trust: ['trust', 'believe', 'faith', 'confident', 'reliable', 'dependable', 'loyal', 'devoted', 'honest', 'integrity'],
        anticipation: ['anticipate', 'expect', 'look forward', 'hopeful', 'excited', 'await', 'eager', 'preparation', 'ready', 'future'],
        love: ['love', 'adore', 'affection', 'caring', 'beloved', 'cherish', 'fondness', 'attached', 'romance', 'passion']
      };
      
      // Initialize emotions with base values
      const analyzedEmotions = {
        joy: 20 + Math.floor(Math.random() * 20),
        sadness: 20 + Math.floor(Math.random() * 20),
        anger: 10 + Math.floor(Math.random() * 15),
        fear: 10 + Math.floor(Math.random() * 15),
        surprise: 10 + Math.floor(Math.random() * 15),
        disgust: 5 + Math.floor(Math.random() * 10),
        trust: 20 + Math.floor(Math.random() * 20),
        anticipation: 20 + Math.floor(Math.random() * 20),
        love: 20 + Math.floor(Math.random() * 20)
      };
      
      // Adjust based on word matches
      words.forEach(word => {
        Object.keys(emotionWords).forEach(emotion => {
          if (emotionWords[emotion].some(emotionWord => word.includes(emotionWord))) {
            // Increment emotion score when a matching word is found
            analyzedEmotions[emotion] += 10 + Math.floor(Math.random() * 15);
          }
        });
      });
      
      // Cap values at 100
      Object.keys(analyzedEmotions).forEach(emotion => {
        analyzedEmotions[emotion] = Math.min(analyzedEmotions[emotion], 100);
      });
      
      return analyzedEmotions;
    }
    
    // Load sample journal entries
    function loadSampleJournalEntries() {
      // Sample entries with timestamp and emotions
      journalEntries = [
        {
          title: "Feeling optimistic today",
          date: new Date(),
          text: "Had a productive meeting with the team. The project is finally moving forward after weeks of delays.",
          emotions: {
            joy: 80,
            sadness: 10,
            anger: 5,
            fear: 20,
            surprise: 30,
            disgust: 0,
            trust: 85,
            anticipation: 75,
            love: 60
          }
        },
        {
          title: "Unexpected news",
          date: new Date(Date.now() - 24 * 60 * 60 * 1000), // Yesterday
          text: "Received some unexpected news about the project deadline. Feeling a mix of stress and excitement about the challenge.",
          emotions: {
            joy: 40,
            sadness: 30,
            anger: 25,
            fear: 65,
            surprise: 90,
            disgust: 10,
            trust: 50,
            anticipation: 80,
            love: 20
          }
        },
        {
          title: "Weekend reflection",
          date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000), // 2 days ago
          text: "Taking time to reflect on the past week. Grateful for the support of friends and family during challenging moments.",
          emotions: {
            joy: 75,
            sadness: 30,
            anger: 5,
            fear: 15,
            surprise: 20,
            disgust: 0,
            trust: 90,
            anticipation: 60,
            love: 85
          }
        },
        {
          title: "Frustrating delay",
          date: new Date(Date.now() - 4 * 24 * 60 * 60 * 1000), // 4 days ago
          text: "The software update caused unexpected issues. Had to spend hours troubleshooting instead of making progress on the actual project.",
          emotions: {
            joy: 10,
            sadness: 60,
            anger: 85,
            fear: 35,
            surprise: 40,
            disgust: 70,
            trust: 20,
            anticipation: 30,
            love: 10
          }
        },
        {
          title: "Breakthrough moment",
          date: new Date(Date.now() - 6 * 24 * 60 * 60 * 1000), // 6 days ago
          text: "Finally solved the persistent bug that's been causing issues for weeks! The solution was simpler than expected once I took a step back.",
          emotions: {
            joy: 90,
            sadness: 5,
            anger: 0,
            fear: 10,
            surprise: 75,
            disgust: 0,
            trust: 65,
            anticipation: 50,
            love: 40
          }
        }
      ];
      
      // Update journal list
      updateJournalList();
    }
    
    // Update journal entries list
    function updateJournalList() {
      const journalList = document.getElementById('journal-list');
      journalList.innerHTML = '';
      
      journalEntries.forEach(entry => {
        const entryElement = document.createElement('div');
        entryElement.className = 'journal-entry';
        
        // Format date
        const formattedDate = formatDate(entry.date);
        
        // Create entry HTML
        entryElement.innerHTML = `
          <div class="entry-header">
            <div class="entry-title">${entry.title}</div>
            <div class="entry-date">${formattedDate}</div>
          </div>
          <div class="entry-text">
            ${entry.text.substring(0, 100)}${entry.text.length > 100 ? '...' : ''}
          </div>
          <div class="entry-emotion-tags">
            ${getTopEmotionTags(entry.emotions)}
          </div>
        `;
        
        // Add to list
        journalList.appendChild(entryElement);
      });
    }
    
    // Get top 3 emotions as tags
    function getTopEmotionTags(emotions) {
      const sortedEmotions = Object.entries(emotions)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 3);
        
      return sortedEmotions.map(([emotion, value]) => 
        `<div class="emotion-tag ${emotion}">${capitalizeFirstLetter(emotion)}</div>`
      ).join('');
    }
    
    // Format date helper
    function formatDate(date) {
      const now = new Date();
      const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
      
      if (diffDays === 0) {
        return `Today, ${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')} ${date.getHours() >= 12 ? 'PM' : 'AM'}`;
      } else if (diffDays === 1) {
        return `Yesterday, ${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')} ${date.getHours() >= 12 ? 'PM' : 'AM'}`;
      } else if (diffDays < 7) {
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        return `${days[date.getDay()]}, ${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')} ${date.getHours() >= 12 ? 'PM' : 'AM'}`;
      } else {
        return `${date.getMonth() + 1}/${date.getDate()}/${date.getFullYear()}`;
      }
    }
    
    // Capitalize first letter helper
    function capitalizeFirstLetter(string) {
      return string.charAt(0).toUpperCase() + string.slice(1);
    }
    
    // Update all visualizations
    function updateVisualizations() {
      switch (selectedTab) {
        case 'wheel':
          updateEmotionWheel();
          break;
        case 'space':
          update3DEmotionSpace();
          break;
        case 'timeline':
          updateEmotionTimeline();
          break;
        case 'network':
          updateEmotionNetwork();
          break;
      }
      
      // Update metrics
      updateMetrics();
    }
    
    // Initialize emotion wheel visualization
    function initEmotionWheel() {
      const container = document.getElementById('emotion-wheel-container');
      
      // Set up SVG
      const width = container.clientWidth;
      const height = container.clientHeight;
      const radius = Math.min(width, height) / 2 - 50;
      
      // Create SVG
      emotionWheelSvg = d3.select(container)
        .append('svg')
        .attr('width', width)
        .attr('height', height)
        .append('g')
        .attr('transform', `translate(${width / 2}, ${height / 2})`);
        
      // Create tooltip
      const tooltip = d3.select(container)
        .append('div')
        .attr('class', 'tooltip')
        .style('opacity', 0);
      
      // Draw wheel
      updateEmotionWheel();
      
      // Handle window resize
      window.addEventListener('resize', () => {
        const newWidth = container.clientWidth;
        const newHeight = container.clientHeight;
        
        d3.select(container).select('svg')
          .attr('width', newWidth)
          .attr('height', newHeight);
          
        emotionWheelSvg.attr('transform', `translate(${newWidth / 2}, ${newHeight / 2})`);
        
        updateEmotionWheel();
      });
    }
    
    // Update emotion wheel visualization
    function updateEmotionWheel() {
      if (!emotionWheelSvg) return;
      
      // Clear previous elements
      emotionWheelSvg.selectAll('*').remove();
      
      const container = document.getElementById('emotion-wheel-container');
      const width = container.clientWidth;
      const height = container.clientHeight;
      const radius = Math.min(width, height) / 2 - 80;
      
      // Define emotion colors
      const colors = {
        joy: 'var(--joy-color)',
        sadness: 'var(--sadness-color)',
        anger: 'var(--anger-color)',
        fear: 'var(--fear-color)',
        surprise: 'var(--surprise-color)',
        disgust: 'var(--disgust-color)',
        trust: 'var(--trust-color)',
        anticipation: 'var(--anticipation-color)',
        love: 'var(--love-color)'
      };
      
      // Create data for pie chart
      const emotionData = Object.entries(emotions).map(([name, value]) => ({
        name,
        value,
        color: colors[name] || '#999999'
      }));
      
      // Create pie layout
      const pie = d3.pie()
        .value(d => d.value)
        .sort(null);
      
      // Create arc generator
      const arc = d3.arc()
        .innerRadius(radius * 0.3) // Inner radius for donut chart
        .outerRadius(d => radius * (0.7 + (d.data.value / 300))); // Outer radius varies by emotion intensity
      
      // Create arcs
      const arcs = emotionWheelSvg.selectAll('path')
        .data(pie(emotionData))
        .enter()
        .append('path')
        .attr('d', arc)
        .attr('fill', d => d.data.color)
        .attr('stroke', '#000')
        .attr('stroke-width', 1)
        .attr('opacity', 0.8)
        .on('mouseover', function(event, d) {
          d3.select(this)
            .transition()
            .duration(200)
            .attr('opacity', 1)
            .attr('transform', 'scale(1.05)');
            
          // Show tooltip
          d3.select('.tooltip')
            .style('opacity', 0.9)
            .html(`${capitalizeFirstLetter(d.data.name)}: ${d.data.value}%`)
            .style('left', (event.pageX + 10) + 'px')
            .style('top', (event.pageY - 15) + 'px');
        })
        .on('mouseout', function() {
          d3.select(this)
            .transition()
            .duration(200)
            .attr('opacity', 0.8)
            .attr('transform', 'scale(1)');
            
          // Hide tooltip
          d3.select('.tooltip')
            .style('opacity', 0);
        });
      
      // Add labels if enabled
      if (document.getElementById('labels-toggle').classList.contains('active')) {
        const showLabels = emotionWheelSvg.selectAll('text')
          .data(pie(emotionData))
          .enter()
          .append('text')
          .attr('transform', d => `translate(${arc.centroid(d)})`)
          .attr('dy', '.35em')
          .attr('text-anchor', 'middle')
          .attr('fill', 'white')
          .attr('font-size', '12px')
          .attr('font-weight', 'bold')
          .attr('pointer-events', 'none')
          .text(d => d.data.value > 15 ? capitalizeFirstLetter(d.data.name) : '');
      }
      
      // Add center circle
      emotionWheelSvg.append('circle')
        .attr('cx', 0)
        .attr('cy', 0)
        .attr('r', radius * 0.3)
        .attr('fill', 'var(--background-medium)')
        .attr('stroke', 'rgba(255, 255, 255, 0.2)')
        .attr('stroke-width', 2);
      
      // Add center text
      emotionWheelSvg.append('text')
        .attr('x', 0)
        .attr('y', -5)
        .attr('text-anchor', 'middle')
        .attr('fill', 'var(--text-primary)')
        .attr('font-family', 'Orbitron, sans-serif')
        .attr('font-size', '14px')
        .text('EMOTIONAL');
        
      emotionWheelSvg.append('text')
        .attr('x', 0)
        .attr('y', 15)
        .attr('text-anchor', 'middle')
        .attr('fill', 'var(--text-primary)')
        .attr('font-family', 'Orbitron, sans-serif')
        .attr('font-size', '14px')
        .text('STATE');
    }
    
    // Initialize 3D emotion space
    function init3DEmotionSpace() {
      const container = document.getElementById('emotion-space-container');
      
      // Set up Three.js scene
      scene = new THREE.Scene();
      
      // Camera
      camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
      camera.position.z = 20;
      
      // Renderer
      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setSize(container.clientWidth, container.clientHeight);
      renderer.setClearColor(0x000000, 0);
      container.appendChild(renderer.domElement);
      
      // Controls
      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;
      controls.rotateSpeed = 0.5;
      
      // Add subtle ambient light
      const ambientLight = new THREE.AmbientLight(0x222266, 0.8);
      scene.add(ambientLight);
      
      // Add directional lights with colors
      const light1 = new THREE.DirectionalLight(0x00f0ff, 0.7);
      light1.position.set(5, 5, 5);
      scene.add(light1);
      
      const light2 = new THREE.DirectionalLight(0x7700ff, 0.7);
      light2.position.set(-5, -5, 5);
      scene.add(light2);
      
      // Post-processing
      composer = new THREE.EffectComposer(renderer);
      const renderPass = new THREE.RenderPass(scene, camera);
      composer.addPass(renderPass);
      
      const bloomPass = new THREE.UnrealBloomPass(
        new THREE.Vector2(container.clientWidth, container.clientHeight),
        1.5, // strength
        0.4, // radius
        0.85 // threshold
      );
      composer.addPass(bloomPass);
      
      // Create 3D visualization elements
      update3DEmotionSpace();
      
      // Animation loop
      function animate() {
        requestAnimationFrame(animate);
        
        // Only render if this tab is selected
        if (selectedTab === 'space') {
          controls.update();
          
          // Animate emotion spheres
          if (document.getElementById('animation-toggle').classList.contains('active')) {
            const time = Date.now() * 0.001;
            
            emotionSpheres.forEach((sphere, i) => {
              const speed = 0.2 + (sphere.intensity / 200);
              sphere.mesh.position.y += Math.sin(time * speed + i) * 0.01;
              
              // Pulse effect
              const scale = 1 + 0.1 * Math.sin(time * 2 + i);
              sphere.mesh.scale.set(scale, scale, scale);
            });
          }
          
          composer.render();
        }
      }
      
      animate();
      
      // Handle window resize
      window.addEventListener('resize', () => {
        if (selectedTab === 'space') {
          const newWidth = container.clientWidth;
          const newHeight = container.clientHeight;
          
          // Update camera aspect ratio
          camera.aspect = newWidth / newHeight;
          camera.updateProjectionMatrix();
          
          // Update renderer size
          renderer.setSize(newWidth, newHeight);
          composer.setSize(newWidth, newHeight);
        }
      });
    }
    
    // Update 3D emotion space
    function update3DEmotionSpace() {
      if (!scene) return;
      
      // Clear previous spheres
      emotionSpheres.forEach(sphere => {
        scene.remove(sphere.mesh);
      });
      emotionSpheres = [];
      
      // Define emotion colors
      const colors = {
        joy: 0xffcc00,
        sadness: 0x0077ff,
        anger: 0xff3333,
        fear: 0x7700ff,
        surprise: 0x00ffa3,
        disgust: 0x88cc00,
        trust: 0x00ccff,
        anticipation: 0xff9900,
        love: 0xff66aa
      };
      
      // Create emotional space axes
      // Using valence-arousal-dominance model
      // Valence: X axis (negative to positive)
      // Arousal: Y axis (calm to excited)
      // Dominance: Z axis (submissive to dominant)
      
      // Create axis lines
      createAxis('X', new THREE.Vector3(-10, 0, 0), new THREE.Vector3(10, 0, 0), 0xffffff);
      createAxis('Y', new THREE.Vector3(0, -10, 0), new THREE.Vector3(0, 10, 0), 0xffffff);
      createAxis('Z', new THREE.Vector3(0, 0, -10), new THREE.Vector3(0, 0, 10), 0xffffff);
      
      // Add small axis labels
      addAxisLabel('Negative', new THREE.Vector3(-10, 0, 0), 0xffffff);
      addAxisLabel('Positive', new THREE.Vector3(10, 0, 0), 0xffffff);
      addAxisLabel('Calm', new THREE.Vector3(0, -10, 0), 0xffffff);
      addAxisLabel('Excited', new THREE.Vector3(0, 10, 0), 0xffffff);
      addAxisLabel('Submissive', new THREE.Vector3(0, 0, -10), 0xffffff);
      addAxisLabel('Dominant', new THREE.Vector3(0, 0, 10), 0xffffff);
      
      // Map emotions to 3D space
      const emotionPositions = {
        joy: new THREE.Vector3(8, 5, 2),
        sadness: new THREE.Vector3(-6, -4, -3),
        anger: new THREE.Vector3(-5, 8, 6),
        fear: new THREE.Vector3(-7, 6, -5),
        surprise: new THREE.Vector3(2, 9, 0),
        disgust: new THREE.Vector3(-4, 2, 4),
        trust: new THREE.Vector3(7, -2, 3),
        anticipation: new THREE.Vector3(5, 4, 4),
        love: new THREE.Vector3(9, 2, 1)
      };
      
      // Create emotion spheres
      Object.entries(emotions).forEach(([emotion, intensity]) => {
        const position = emotionPositions[emotion];
        if (!position) return;
        
        // Scale position based on intensity
        const scaledPosition = position.clone().multiplyScalar(intensity / 100);
        
        // Create sphere
        const size = 0.5 + (intensity / 100);
        const geometry = new THREE.SphereGeometry(size, 32, 32);
        const material = new THREE.MeshPhongMaterial({
          color: colors[emotion],
          emissive: colors[emotion],
          emissiveIntensity: intensity / 200,
          transparent: true,
          opacity: 0.8
        });
        
        const sphere = new THREE.Mesh(geometry, material);
        sphere.position.copy(scaledPosition);
        
        // Add to scene
        scene.add(sphere);
        
        // Add to spheres array
        emotionSpheres.push({
          emotion,
          intensity,
          mesh: sphere
        });
        
        // Add label if enabled
        if (document.getElementById('labels-toggle').classList.contains('active')) {
          addEmotionLabel(emotion, scaledPosition, colors[emotion]);
        }
      });
    }
    
    // Helper function to create axis
    function createAxis(name, start, end, color) {
      const points = [start, end];
      const geometry = new THREE.BufferGeometry().setFromPoints(points);
      const material = new THREE.LineBasicMaterial({ color: color, opacity: 0.5, transparent: true });
      const line = new THREE.Line(geometry, material);
      scene.add(line);
      return line;
    }
    
    // Helper function to add axis label
    function addAxisLabel(text, position, color) {
      // Use a small sphere as label (in a real app, would use text sprites)
      const geometry = new THREE.SphereGeometry(0.2, 16, 16);
      const material = new THREE.MeshBasicMaterial({ color: color, opacity: 0.7, transparent: true });
      const sphere = new THREE.Mesh(geometry, material);
      sphere.position.copy(position);
      scene.add(sphere);
      
      return sphere;
    }
    
    // Helper function to add emotion label
    function addEmotionLabel(text, position, color) {
      // Use a small sphere with a different color as label
      const geometry = new THREE.SphereGeometry(0.3, 16, 16);
      const material = new THREE.MeshBasicMaterial({ color: color, opacity: 0.9, transparent: true });
      const sphere = new THREE.Mesh(geometry, material);
      
      // Position slightly above the emotion sphere
      const labelPosition = position.clone().add(new THREE.Vector3(0, 0.5, 0));
      sphere.position.copy(labelPosition);
      
      scene.add(sphere);
      return sphere;
    }
    
    // Initialize emotion timeline
    function initEmotionTimeline() {
      const container = document.getElementById('emotion-timeline-container');
      
      // Set up SVG
      const width = container.clientWidth;
      const height = container.clientHeight;
      const margin = { top: 40, right: 40, bottom: 60, left: 60 };
      const innerWidth = width - margin.left - margin.right;
      const innerHeight = height - margin.top - margin.bottom;
      
      // Create SVG
      timelineSvg = d3.select(container)
        .append('svg')
        .attr('width', width)
        .attr('height', height)
        .append('g')
        .attr('transform', `translate(${margin.left}, ${margin.top})`);
      
      // Create tooltip
      const tooltip = d3.select(container)
        .append('div')
        .attr('class', 'tooltip')
        .style('opacity', 0);
      
      // Draw timeline
      updateEmotionTimeline();
      
      // Handle window resize
      window.addEventListener('resize', () => {
        if (selectedTab === 'timeline') {
          const newWidth = container.clientWidth;
          const newHeight = container.clientHeight;
          
          d3.select(container).select('svg')
            .attr('width', newWidth)
            .attr('height', newHeight);
          
          updateEmotionTimeline();
        }
      });
    }
    
    // Update emotion timeline
    function updateEmotionTimeline() {
      if (!timelineSvg) return;
      
      // Clear previous elements
      timelineSvg.selectAll('*').remove();
      
      const container = document.getElementById('emotion-timeline-container');
      const width = container.clientWidth;
      const height = container.clientHeight;
      const margin = { top: 40, right: 40, bottom: 60, left: 60 };
      const innerWidth = width - margin.left - margin.right;
      const innerHeight = height - margin.top - margin.bottom;
      
      // Get time range
      const timeRange = document.getElementById('time-range').value;
      let startDate, endDate;
      
      const now = new Date();
      
      switch (timeRange) {
        case 'day':
          startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);
          endDate = now;
          break;
        case 'week':
          startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
          endDate = now;
          break;
        case 'month':
          startDate = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
          endDate = now;
          break;
        case 'year':
          startDate = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate());
          endDate = now;
          break;
        default:
          startDate = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate());
          endDate = now;
      }
      
      // Filter entries by time range
      const filteredEntries = journalEntries.filter(entry => 
        entry.date >= startDate && entry.date <= endDate
      );
      
      // Create scales
      const xScale = d3.scaleTime()
        .domain([startDate, endDate])
        .range([0, innerWidth]);
      
      const yScale = d3.scaleLinear()
        .domain([0, 100])
        .range([innerHeight, 0]);
      
      // Create axes
      const xAxis = d3.axisBottom(xScale);
      const yAxis = d3.axisLeft(yScale);
      
      // Add X axis
      timelineSvg.append('g')
        .attr('transform', `translate(0, ${innerHeight})`)
        .call(xAxis)
        .selectAll('text')
        .style('fill', 'white')
        .style('font-size', '10px');
      
      // Add Y axis
      timelineSvg.append('g')
        .call(yAxis)
        .selectAll('text')
        .style('fill', 'white')
        .style('font-size', '10px');
      
      // Add Y axis label
      timelineSvg.append('text')
        .attr('transform', 'rotate(-90)')
        .attr('y', -40)
        .attr('x', -innerHeight / 2)
        .attr('text-anchor', 'middle')
        .style('fill', 'white')
        .text('Emotion Intensity');
      
      // Create color scale
      const colors = {
        joy: 'var(--joy-color)',
        sadness: 'var(--sadness-color)',
        anger: 'var(--anger-color)',
        fear: 'var(--fear-color)',
        surprise: 'var(--surprise-color)',
        disgust: 'var(--disgust-color)',
        trust: 'var(--trust-color)',
        anticipation: 'var(--anticipation-color)',
        love: 'var(--love-color)'
      };
      
      // Create line generator
      const line = d3.line()
        .x(d => xScale(d.date))
        .y(d => yScale(d.value))
        .curve(d3.curveMonotoneX);
      
      // Create lines for each emotion
      const emotionNames = Object.keys(emotions);
      
      emotionNames.forEach(emotion => {
        // Get data points for this emotion
        const data = filteredEntries.map(entry => ({
          date: entry.date,
          value: entry.emotions[emotion] || 0
        }));
        
        // Sort by date
        data.sort((a, b) => a.date - b.date);
        
        // Add current emotion state
        data.push({
          date: now,
          value: emotions[emotion]
        });
        
        // Only draw line if we have enough data points
        if (data.length > 1) {
          // Create line
          timelineSvg.append('path')
            .datum(data)
            .attr('fill', 'none')
            .attr('stroke', colors[emotion])
            .attr('stroke-width', 2)
            .attr('d', line)
            .style('opacity', 0.8);
          
          // Add dots for data points
          timelineSvg.selectAll(`.dot-${emotion}`)
            .data(data)
            .enter()
            .append('circle')
            .attr('class', `dot-${emotion}`)
            .attr('cx', d => xScale(d.date))
            .attr('cy', d => yScale(d.value))
            .attr('r', 4)
            .attr('fill', colors[emotion])
            .on('mouseover', function(event, d) {
              d3.select(this)
                .transition()
                .duration(200)
                .attr('r', 6);
                
              // Show tooltip
              d3.select('.tooltip')
                .style('opacity', 0.9)
                .html(`${capitalizeFirstLetter(emotion)}: ${d.value}%<br/>${formatDate(d.date)}`)
                .style('left', (event.pageX + 10) + 'px')
                .style('top', (event.pageY - 30) + 'px');
            })
            .on('mouseout', function() {
              d3.select(this)
                .transition()
                .duration(200)
                .attr('r', 4);
                
              // Hide tooltip
              d3.select('.tooltip')
                .style('opacity', 0);
            });
        }
      });
      
      // Add legend
      const legendItemWidth = 80;
      const legendItemHeight = 20;
      const legendPerRow = Math.floor(innerWidth / legendItemWidth);
      
      emotionNames.forEach((emotion, i) => {
        const row = Math.floor(i / legendPerRow);
        const col = i % legendPerRow;
        
        const legendGroup = timelineSvg.append('g')
          .attr('transform', `translate(${col * legendItemWidth}, ${innerHeight + 40 + row * legendItemHeight})`);
        
        legendGroup.append('rect')
          .attr('width', 10)
          .attr('height', 10)
          .attr('fill', colors[emotion]);
        
        legendGroup.append('text')
          .attr('x', 15)
          .attr('y', 9)
          .text(capitalizeFirstLetter(emotion))
          .style('font-size', '10px')
          .style('fill', 'white');
          
        // Make legend items clickable to toggle visibility
        legendGroup.style('cursor', 'pointer')
          .on('click', function() {
            const isActive = !d3.select(this).classed('inactive');
            d3.select(this).classed('inactive', isActive);
            
            // Toggle opacity of corresponding line and dots
            timelineSvg.selectAll(`path[stroke="${colors[emotion]}"]`)
              .style('opacity', isActive ? 0.2 : 0.8);
              
            timelineSvg.selectAll(`.dot-${emotion}`)
              .style('opacity', isActive ? 0.2 : 1);
          });
      });
    }
    
    // Initialize emotion network
    function initEmotionNetwork() {
      const container = document.getElementById('emotion-network-container');
      
      // Set up SVG
      const width = container.clientWidth;
      const height = container.clientHeight;
      
      // Create SVG
      networkSvg = d3.select(container)
        .append('svg')
        .attr('width', width)
        .attr('height', height);
      
      // Create tooltip
      const tooltip = d3.select(container)
        .append('div')
        .attr('class', 'tooltip')
        .style('opacity', 0);
      
      // Draw network
      updateEmotionNetwork();
      
      // Handle window resize
      window.addEventListener('resize', () => {
        if (selectedTab === 'network') {
          const newWidth = container.clientWidth;
          const newHeight = container.clientHeight;
          
          d3.select(container).select('svg')
            .attr('width', newWidth)
            .attr('height', newHeight);
          
          updateEmotionNetwork();
        }
      });
    }
    
    // Update emotion network
    function updateEmotionNetwork() {
      if (!networkSvg) return;
      
      // Clear previous elements
      networkSvg.selectAll('*').remove();
      
      const container = document.getElementById('emotion-network-container');
      const width = container.clientWidth;
      const height = container.clientHeight;
      
      // Create nodes for emotions
      const nodes = Object.entries(emotions).map(([name, value]) => ({
        id: name,
        value: value,
        size: 20 + (value / 3)
      }));
      
      // Create links between emotions
      // This could be based on psychological research about emotion relationships
      // or derived from personal data
      const links = [
        { source: 'joy', target: 'love', value: 7 },
        { source: 'joy', target: 'trust', value: 6 },
        { source: 'joy', target: 'anticipation', value: 5 },
        { source: 'joy', target: 'surprise', value: 4 },
        
        { source: 'sadness', target: 'fear', value: 5 },
        { source: 'sadness', target: 'disgust', value: 3 },
        
        { source: 'anger', target: 'disgust', value: 6 },
        { source: 'anger', target: 'fear', value: 4 },
        
        { source: 'trust', target: 'love', value: 7 },
        { source: 'trust', target: 'anticipation', value: 5 },
        
        { source: 'anticipation', target: 'surprise', value: 4 },
        { source: 'anticipation', target: 'joy', value: 5 },
        
        { source: 'love', target: 'joy', value: 7 },
        { source: 'love', target: 'trust', value: 7 },
        
        { source: 'surprise', target: 'joy', value: 4 },
        { source: 'surprise', target: 'fear', value: 4 },
        
        { source: 'fear', target: 'sadness', value: 5 },
        { source: 'fear', target: 'surprise', value: 4 },
        
        { source: 'disgust', target: 'anger', value: 6 },
        { source: 'disgust', target: 'sadness', value: 3 }
      ];
      
      // Define colors
      const colors = {
        joy: 'var(--joy-color)',
        sadness: 'var(--sadness-color)',
        anger: 'var(--anger-color)',
        fear: 'var(--fear-color)',
        surprise: 'var(--surprise-color)',
        disgust: 'var(--disgust-color)',
        trust: 'var(--trust-color)',
        anticipation: 'var(--anticipation-color)',
        love: 'var(--love-color)'
      };
      
      // Create force simulation
      const simulation = d3.forceSimulation(nodes)
        .force('link', d3.forceLink(links).id(d => d.id).distance(d => 200 - d.value * 10))
        .force('charge', d3.forceManyBody().strength(-300))
        .force('center', d3.forceCenter(width / 2, height / 2))
        .force('collision', d3.forceCollide().radius(d => d.size + 5));
      
      // Create links
      const link = networkSvg.append('g')
        .selectAll('line')
        .data(links)
        .enter()
        .append('line')
        .attr('stroke', '#aaaaff')
        .attr('stroke-opacity', 0.3)
        .attr('stroke-width', d => d.value);
      
      // Create nodes
      const node = networkSvg.append('g')
        .selectAll('circle')
        .data(nodes)
        .enter()
        .append('circle')
        .attr('r', d => d.size)
        .attr('fill', d => colors[d.id])
        .style('cursor', 'pointer')
        .on('mouseover', function(event, d) {
          // Highlight connected links
          link
            .attr('stroke-opacity', l => (l.source.id === d.id || l.target.id === d.id) ? 0.7 : 0.1)
            .attr('stroke-width', l => (l.source.id === d.id || l.target.id === d.id) ? l.value * 1.5 : l.value);
          
          // Highlight connected nodes
          node
            .attr('opacity', n => (n.id === d.id || links.some(l => 
              (l.source.id === d.id && l.target.id === n.id) || 
              (l.target.id === d.id && l.source.id === n.id)
            )) ? 1 : 0.3);
            
          // Show tooltip
          d3.select('.tooltip')
            .style('opacity', 0.9)
            .html(`${capitalizeFirstLetter(d.id)}: ${d.value}%`)
            .style('left', (event.pageX + 10) + 'px')
            .style('top', (event.pageY - 15) + 'px');
        })
        .on('mouseout', function() {
          // Reset highlights
          link
            .attr('stroke-opacity', 0.3)
            .attr('stroke-width', d => d.value);
          
          node.attr('opacity', 1);
          
          // Hide tooltip
          d3.select('.tooltip')
            .style('opacity', 0);
        })
        .call(d3.drag()
          .on('start', dragstarted)
          .on('drag', dragged)
          .on('end', dragended));
      
      // Add labels if enabled
      if (document.getElementById('labels-toggle').classList.contains('active')) {
        const labels = networkSvg.append('g')
          .selectAll('text')
          .data(nodes)
          .enter()
          .append('text')
          .text(d => capitalizeFirstLetter(d.id))
          .attr('font-size', '12px')
          .attr('dx', d => d.size + 5)
          .attr('dy', 4)
          .attr('fill', 'white');
      }
      
      // Define drag functions
      function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
      }
      
      function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
      }
      
      function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
      }
      
      // Update positions
      simulation.on('tick', () => {
        link
          .attr('x1', d => d.source.x)
          .attr('y1', d => d.source.y)
          .attr('x2', d => d.target.x)
          .attr('y2', d => d.target.y);
        
        node
          .attr('cx', d => d.x)
          .attr('cy', d => d.y);
          
        // Update labels if they exist
        if (document.getElementById('labels-toggle').classList.contains('active')) {
          networkSvg.selectAll('text')
            .attr('x', d => d.x)
            .attr('y', d => d.y);
        }
      });
    }
    
    // Update emotional metrics
    function updateMetrics() {
      // Calculate emotional balance
      // Based on the spread between positive and negative emotions
      const positiveEmotions = ['joy', 'trust', 'anticipation', 'love'];
      const negativeEmotions = ['sadness', 'anger', 'fear', 'disgust'];
      
      const positiveSum = positiveEmotions.reduce((sum, emotion) => sum + emotions[emotion], 0);
      const negativeSum = negativeEmotions.reduce((sum, emotion) => sum + emotions[emotion], 0);
      
      const positiveAvg = positiveSum / positiveEmotions.length;
      const negativeAvg = negativeSum / negativeEmotions.length;
      
      // Balance is how close these are to an ideal ratio (roughly 3:1 positive to negative)
      const idealRatio = 3;
      const actualRatio = positiveAvg / (negativeAvg || 1); // Avoid division by zero
      
      const balanceScore = Math.min(100, Math.round(100 * (1 - Math.abs(idealRatio - actualRatio) / idealRatio)));
      
      // Calculate well-being index
      // Weighted average of positive emotions minus negative emotions
      const wellbeingScore = Math.max(0, Math.min(100, Math.round(
        (positiveAvg * 0.8 - negativeAvg * 0.5 + 10)
      )));
      
      // Calculate emotional variance
      // How much emotions vary from each other
      const emotionValues = Object.values(emotions);
      const emotionAvg = emotionValues.reduce((sum, val) => sum + val, 0) / emotionValues.length;
      const variance = emotionValues.reduce((sum, val) => sum + Math.pow(val - emotionAvg, 2), 0) / emotionValues.length;
      const normalizedVariance = Math.min(100, Math.round(variance / 10));
      
      // Calculate emotional coherence
      // Based on the patterns in journal entries over time
      // For this demo, we'll use a random value weighted by the balance score
      const coherenceScore = Math.min(100, Math.round(
        balanceScore * 0.5 + Math.random() * 40 + 30
      ));
      
      // Update displayed metrics
      document.getElementById('balance-score').textContent = `${balanceScore}%`;
      document.getElementById('wellbeing-score').textContent = `${wellbeingScore}%`;
      document.getElementById('variance-score').textContent = `${normalizedVariance}%`;
      document.getElementById('coherence-score').textContent = `${coherenceScore}%`;
    }
    
    // Update neural insight
    function updateInsight() {
      // In a real app, this would use AI to analyze emotional patterns
      // For this demo, we'll create some sample insights based on the current emotions
      
      const insights = [
        "Your emotional patterns show a positive trend over the past week. Joy and trust are increasing, while fear and sadness are decreasing. This suggests an improvement in your emotional well-being.",
        
        "There's a noticeable balance between your positive and negative emotions, which indicates good emotional regulation. Your high levels of trust suggest strong social connections.",
        
        "Your anticipation levels have been consistently high, suggesting you're looking forward to future events. This forward-thinking mindset can help maintain motivation and optimism.",
        
        "The relationship between your joy and trust suggests a secure emotional foundation. Consider activities that further strengthen these positive emotions.",
        
        "Your emotional variance is relatively low, indicating stability in your emotional state. This can be beneficial for consistent productivity and decision-making.",
        
        "Recent journal entries show increasing emotional coherence, suggesting you're developing a more integrated understanding of your emotional experiences."
      ];
      
      // Choose a random insight
      const randomInsight = insights[Math.floor(Math.random() * insights.length)];
      
      // Update insight text
      document.getElementById('insight-text').textContent = randomInsight;
    }
  </script>
</body>
</html>